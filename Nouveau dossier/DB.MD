# üìö R√©f√©rence de la Base de Donn√©es JPSI (Supabase)

Ce document d√©crit la structure compl√®te de la base de donn√©es telle qu'observ√©e dans les sch√©mas fournis. Il sert de r√©f√©rence unique pour tout le projet.

**Derni√®re mise √† jour :**
- Fonctionnalit√©s front : tri dynamique sur les tableaux clients et sites, compteurs d'√©quipements par site et par client dans l'UI (newVerification.html).
- Syst√®me d'audits complet : cr√©ation, historique, d√©tails avec g√©n√©ration PDF.
- Sch√©ma des tables √† jour avec les besoins actuels (tables d'audits ajout√©es).

---

## √âtat des fonctionnalit√©s front (UI)
- **Tri dynamique** : Les tableaux des clients et des sites sont triables par colonne (clic sur l'en-t√™te, ordre croissant/d√©croissant).
- **Compteurs d'√©quipements** : Le nombre d'extincteurs, d'√©clairages, d'alarmes et de d√©senfumages est affich√© dans les vignettes des sites et dans le header client.
- **Design** : UI moderne, sobre, adapt√©e desktop/mobile.

---

## üßë‚Äçüíº Table : clients
| Champ            | Type    | Description                        |
|------------------|---------|------------------------------------|
| id_client        | int4    | Cl√© primaire                       |
| code_client      | varchar | Code unique (ex: CL0001)           |
| nom_client       | varchar | Nom du client                      |
| adr_client       | text    | Adresse                            |
| tel_client       | varchar | T√©l√©phone                          |
| mail_client      | varchar | Email                              |
| siren_client     | varchar | SIREN                              |
| resp_client      | varchar | Responsable                        |
| mailresp_client  | varchar | Email du responsable               |
| telresp_client   | varchar | T√©l√©phone du responsable           |
| ville_client     | varchar | Ville                              |
| cp_client        | varchar | Code postal                        |

---

## üè¢ Table : sites
| Champ            | Type    | Description                        |
|------------------|---------|------------------------------------|
| id_site          | int4    | Cl√© primaire                       |
| id_client        | int4    | R√©f√©rence client                   |
| adr_site         | varchar | Adresse du site                    |
| ville_site       | varchar | Ville                              |
| cp_site          | varchar | Code postal                        |
| resp_site        | varchar | Responsable site                   |
| telresp_site     | varchar | T√©l√©phone responsable site         |
| mailresp_site    | varchar | Email responsable site             |
| num_site         | varchar | Num√©ro interne site                |
| nom_site         | varchar | Nom du site                        |
| famille_erp      | varchar | Famille ERP (ERP, ERT, Habitation, Priv√©) |
| typeerp_site     | text    | Type ERP (code lettre)             |
| caterp_site      | int2    | Cat√©gorie ERP (1, 2, 3, 4, 5)     |
| lastcomm_site    | date    | Date derni√®re commission de s√©curit√© |

---

## üö® Table : alarmes
| Champ            | Type        | Description                        |
|------------------|-------------|------------------------------------|
| id_alarme        | int4        | Cl√© primaire                       |
| id_site          | int4        | R√©f√©rence site                     |
| type_alarme      | varchar     | Type d'alarme                      |
| marque_alarme    | varchar     | Marque                             |
| modele_alarme    | varchar     | Mod√®le                             |
| notes_alarme     | text        | Notes                              |
| last_alarme      | timestamptz | Date du dernier contr√¥le           |

---

## üñ≤Ô∏è Table : peripheriques
| Champ            | Type        | Description                        |
|------------------|-------------|------------------------------------|
| id_periph        | int4        | Cl√© primaire                       |
| id_alarme        | int4        | R√©f√©rence alarme                   |
| type_periph      | varchar     | Type de p√©riph√©rique               |
| marque_periph    | varchar     | Marque                             |
| modele_periph    | varchar     | Mod√®le                             |
| loc_periph       | varchar     | Localisation                       |
| etat_periph      | bool        | √âtat (fonctionnel ou non)          |
| ok_periph        | bool        | Statut OK                          |
| note_periph      | text        | Note                               |
| last_periph      | timestamp   | Date du dernier contr√¥le           |

---

## üí° Table : eclairages
| Champ              | Type    | Description                        |
|--------------------|---------|------------------------------------|
| id_ecl             | int4    | Cl√© primaire                       |
| id_site            | int4    | R√©f√©rence site                     |
| num_ecl            | varchar | Num√©ro d'√©clairage                  |
| niv_ecl            | varchar | Niveau/√©tage                        |
| loc_ecl            | varchar | Localisation                        |
| marque_ecl         | varchar | Marque                              |
| modele_ecl         | varchar | Mod√®le                              |
| family_ecl         | varchar | Famille/type                        |
| mes_ecl            | varchar | Mesure/puissance                    |
| ip_ecl             | varchar | Indice de protection                |
| sati_ecl           | bool    | Saturation                          |
| telecommande_ecl   | bool    | Pr√©sence t√©l√©commande               |
| etat_batterie_ecl  | bool    | √âtat batterie                       |
| orientation_ecl    | varchar | Orientation                         |
| obs_ecl            | text    | Observations                        |
| last_ecl           | date    | Date du dernier contr√¥le            |

---

## ü™ü Table : desenfumages
| Champ                    | Type        | Description                        |
|--------------------------|-------------|------------------------------------|
| id_desenfumage           | int4        | Cl√© primaire                       |
| id_site                  | int4        | R√©f√©rence site                     |
| equipement_desenfumage   | varchar     | Type d'√©quipement                  |
| explication_installation | text        | Explication installation           |
| created_at               | timestamptz | Date de cr√©ation                   |
| updated_at               | timestamptz | Date de mise √† jour                |

---

## üßØ Table : extincteurs
| Champ        | Type    | Description                        |
|------------- |---------|------------------------------------|
| id_ext       | int4    | Cl√© primaire                       |
| id_site      | int4    | R√©f√©rence site                     |
| num_ext      | varchar | Num√©ro extincteur                  |
| niv_ext      | varchar | Niveau/√©tage                       |
| loc_ext      | varchar | Localisation                       |
| marque_ext   | varchar | Marque                             |
| modele_ext   | varchar | Mod√®le                             |
| agent_ext    | int4    | R√©f√©rence agent extincteur         |
| mes_ext      | varchar | Mesure/volume                      |
| rcm_ext      | varchar | Date recharge/contr√¥le             |
| maa_ext      | varchar | Date maintenance annuelle          |
| eie_ext      | varchar | Date √©preuve interne/externe        |
| pcf_ext      | bool    | Pression/contr√¥le faite             |
| papp_ext     | bool    | Pression apparente (PP=allum√©, PA=√©teint) |
| cert_ext     | varchar | Num√©ro de certificat               |
| capa_ext     | varchar | Capacit√© de l‚Äôextincteur (ex : 6kg, 2Lt) |
| obs_ext      | text    | Observations                       |
| last_ext     | date    | Date du dernier contr√¥le           |

---

## üß™ Table : AgentExtincteur
| Champ      | Type  | Description                |
|------------|-------|---------------------------|
| id_agt     | int8  | Cl√© primaire              |
| long_agt   | text  | Nom long de l‚Äôagent       |
| court_agt  | text  | Nom court de l‚Äôagent      |

---

## üìã Table : fire_extinguisher_certification_registry
| Champ         | Type    | Description                        |
|-------------- |---------|------------------------------------|
| id            | int4    | Cl√© primaire                       |
| marque        | varchar | Marque                             |
| modele        | varchar | Mod√®le                             |
| certification | varchar | Certification                      |
| capacit       | int2    | Capacit√© (correspond √† capa_ext)   |
| agent         | text    | Agent (correspond √† agent_ext)     |

---

## üìã Table : verifications
| Champ            | Type        | Description                        |
|------------------|-------------|------------------------------------|
| id_verification  | int4        | Cl√© primaire                       |
| type_equipement  | varchar     | Type d'√©quipement v√©rifi√©          |
| id_equipement    | int4        | ID de l'√©quipement v√©rifi√©         |
| id_intervention  | int4        | R√©f√©rence intervention              |
| observations     | text        | Observations de la v√©rification     |
| statut           | varchar     | Statut (OK, Pas OK)                |
| date_verification| timestamptz | Date de la v√©rification            |

---

## üîó Relations principales
- **clients (1) ‚Üí (N) sites**
- **sites (1) ‚Üí (N) interventions**
- **sites (1) ‚Üí (N) alarmes**
- **sites (1) ‚Üí (N) peripheriques**
- **sites (1) ‚Üí (N) eclairages**
- **sites (1) ‚Üí (N) desenfumages**
- **sites (1) ‚Üí (N) extincteurs**
- **sites (1) ‚Üí (N) rias**
- **sites (1) ‚Üí (N) plans**
- **interventions (1) ‚Üí (N) verifications**
- **AgentExtincteur (1) ‚Üí (N) extincteurs**
- **fire_extinguisher_certification_registry** : r√©f√©rentiel, pas de cl√© √©trang√®re directe
- **prospects (1) ‚Üí (N) audits**
- **audits (1) ‚Üí (N) audit_equipements**

---

## üí° Table : eclairage_catalogue
| Champ            | Type    | Description                                 |
|------------------|---------|---------------------------------------------|
| id_catalogue_es  | int4    | Cl√© primaire                               |
| lcie_es          | text    | R√©f√©rence LCIE ou autre certification       |
| marque_es        | varchar | Marque de l'√©clairage                      |
| modele_es        | varchar | Mod√®le de l'√©clairage                      |
| famille_es       | varchar | Famille/type                               |
| ampveille_es     | varchar | Amp√©rage en veille                         |
| ampsecours_es    | varchar | Amp√©rage en secours                        |
| ip_es            | varchar | Indice de protection                       |
| sati_es          | bool    | Pr√©sence de SATI (oui/non)                 |

---

---

## üìã Table : prospects
| Champ            | Type        | Description                        |
|------------------|-------------|------------------------------------|
| id_prospect      | int4        | Cl√© primaire                       |
| nom_prospect     | varchar     | Nom du prospect                    |
| adr_prospect     | text        | Adresse                            |
| ville_prospect   | varchar     | Ville                              |
| cp_prospect      | varchar     | Code postal                        |
| tel_prospect     | varchar     | T√©l√©phone                          |
| mail_prospect    | varchar     | Email                              |
| resp_prospect    | varchar     | Responsable                        |
| telresp_prospect | varchar     | T√©l√©phone responsable              |
| mailresp_prospect| varchar     | Email responsable                  |
| siren_prospect   | varchar     | SIREN                              |

---

## üìä Table : audits
| Champ            | Type        | Description                        |
|------------------|-------------|------------------------------------|
| id_audit         | int4        | Cl√© primaire                       |
| id_prospect      | int4        | R√©f√©rence prospect                 |
| date_audit_site  | date        | Date de l'audit                    |
| observation_site | text        | Observations sur site              |
| statut           | varchar     | Statut (En cours, Termin√©, Annul√©) |

---

## üîß Table : audit_equipements
| Champ            | Type        | Description                        |
|------------------|-------------|------------------------------------|
| id_equipement    | int4        | Cl√© primaire                       |
| id_audit         | int4        | R√©f√©rence audit                    |
| type_extincteur  | varchar     | Type d'extincteur propos√©          |
| localisation     | varchar     | Localisation de l'√©quipement       |
| justification    | text        | Justification de l'√©quipement      |
| quantite         | int4        | Quantit√© propos√©e                  |

---

---

## üö® Table : interventions
| Champ                | Type        | Description                        |
|----------------------|-------------|------------------------------------|
| id_intervention      | int4        | Cl√© primaire                       |
| numero_intervention  | varchar     | Num√©ro unique de l'intervention    |
| id_site              | int4        | R√©f√©rence site                     |
| date_debut           | date        | Date de d√©but de l'intervention    |
| etat_intervention    | varchar     | √âtat (En cours, Termin√©, Annul√©)  |
| types_equipements    | text[]      | Types d'√©quipements √† contr√¥ler    |
| observations         | text        | Observations g√©n√©rales             |
| date_creation        | timestamptz | Date de cr√©ation                   |

---

## üìã Table : rias
| Champ                    | Type        | Description                        |
|--------------------------|-------------|------------------------------------|
| id_ria                   | int4        | Cl√© primaire                       |
| id_site                  | int4        | R√©f√©rence site                     |
| numero_ria               | varchar     | Num√©ro du RIA                      |
| niveau_ria               | varchar     | Niveau/√©tage                       |
| emplacement_ria          | varchar     | Emplacement pr√©cis                 |
| marque_ria               | varchar     | Marque du RIA                      |
| modele_ria               | varchar     | Mod√®le du RIA                      |
| diffuseur_ria            | varchar     | Type de diffuseur                  |
| longueur_ria             | varchar     | Longueur du tuyau/lance            |
| diametre_ria             | varchar     | Diam√®tre du tuyau                  |
| pression_statique_ria    | varchar     | Pression statique                  |
| pression_dynamique_ria   | varchar     | Pression dynamique                 |
| type_vanne_arret_ria     | varchar     | Type de vanne d'arr√™t              |
| presence_panneau_ria     | bool        | Pr√©sence d'un panneau              |
| date_creation_ria        | timestamptz | Date de cr√©ation                   |
| date_modification_ria    | timestamptz | Date de modification               |

---

## üìã Table : plans
| Champ                | Type        | Description                        |
|----------------------|-------------|------------------------------------|
| id_plan              | int4        | Cl√© primaire                       |
| id_site              | int4        | R√©f√©rence site                     |
| numero_plan          | varchar     | Num√©ro du plan                     |
| niveau_plan          | varchar     | Niveau/√©tage                       |
| emplacement_plan     | varchar     | Emplacement pr√©cis                 |
| type_plan            | varchar     | Type de plan                       |
| exactitude_plan      | bool        | Exactitude du plan                 |
| date_creation_plan   | timestamptz | Date de cr√©ation                   |
| date_modification_plan| timestamptz| Date de modification               |

---

**Ce document est la r√©f√©rence officielle de la structure de la base JPSI pour tout le projet.** 