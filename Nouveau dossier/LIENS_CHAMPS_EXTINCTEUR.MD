# ğŸ”— Liens entre les champs du formulaire et les tables de la base de donnÃ©es

## ğŸ“‹ Formulaire d'ajout d'extincteur (`extSite.html`)

### ğŸ§¯ Table : `extincteurs` (table principale)

| Champ du formulaire | ID HTML | Type | Table | Champ DB | Description |
|-------------------|---------|------|-------|----------|-------------|
| **NumÃ©ro** | `num_ext` | text | `extincteurs` | `num_ext` | NumÃ©ro de l'extincteur |
| **Niveau** | `niv_ext` | text | `extincteurs` | `niv_ext` | Niveau/Ã©tage |
| **Localisation** | `loc_ext` | text | `extincteurs` | `loc_ext` | Localisation |
| **Marque** | `marque_ext` | text | `extincteurs` | `marque_ext` | Marque de l'extincteur |
| **ModÃ¨le** | `modele_ext` | text | `extincteurs` | `modele_ext` | ModÃ¨le de l'extincteur |
| **Agent** | `agent_ext` | select | `extincteurs` | `agent_ext` | RÃ©fÃ©rence vers `AgentExtincteur.id_agt` |
| **CapacitÃ©** | `capa_ext` | select | `extincteurs` | `capa_ext` | CapacitÃ© (ex: 6kg, 2Lt) |
| **RCM** | `rcm_ext` | text | `extincteurs` | `rcm_ext` | Date recharge/contrÃ´le |
| **MAA** | `maa_ext` | text | `extincteurs` | `maa_ext` | Date maintenance annuelle |
| **EIE** | `eie_ext` | text | `extincteurs` | `eie_ext` | Date Ã©preuve interne/externe |
| **Panneau** | `pcf_ext` | checkbox | `extincteurs` | `pcf_ext` | Pression/contrÃ´le faite |
| **Certification** | `cert_ext` | text | `extincteurs` | `cert_ext` | NumÃ©ro de certificat |
| **Site** | - | - | `extincteurs` | `id_site` | RÃ©fÃ©rence vers `sites.id_site` |

---

## ğŸ” Table : `fire_extinguisher_certification_registry` (registre de certification)

### Fonction de recherche automatique
Quand l'utilisateur saisit un numÃ©ro de certification et clique sur ğŸ” :

| Champ recherchÃ© | Champ retournÃ© | Table | Champ DB | Utilisation |
|----------------|----------------|-------|----------|-------------|
| `cert_ext` | `marque` | `fire_extinguisher_certification_registry` | `marque` | Remplit `marque_ext` |
| `cert_ext` | `modele` | `fire_extinguisher_certification_registry` | `modele` | Remplit `modele_ext` |
| `cert_ext` | `agent` | `fire_extinguisher_certification_registry` | `agent` | Remplit `agent_ext` |
| `cert_ext` | `capacit` | `fire_extinguisher_certification_registry` | `capacit` | Remplit `capa_ext` |

---

## ğŸ§ª Table : `AgentExtincteur` (rÃ©fÃ©rentiel des agents)

### Chargement dynamique des options

| Champ du formulaire | ID HTML | Table | Champ DB | Description |
|-------------------|---------|-------|----------|-------------|
| **Agent** | `agent_ext` | `AgentExtincteur` | `id_agt` | ClÃ© primaire |
| - | - | `AgentExtincteur` | `long_agt` | Texte affichÃ© dans le select |
| - | - | `AgentExtincteur` | `court_agt` | Nom court (non utilisÃ©) |

**Fonction :** `loadAgents()` charge tous les agents triÃ©s par `long_agt`

---

## ğŸ”„ Relations entre les tables

### 1. **extincteurs â†’ sites**
- `extincteurs.id_site` â†’ `sites.id_site`
- **Type :** ClÃ© Ã©trangÃ¨re
- **Usage :** Lier l'extincteur au site

### 2. **extincteurs â†’ AgentExtincteur**
- `extincteurs.agent_ext` â†’ `AgentExtincteur.id_agt`
- **Type :** ClÃ© Ã©trangÃ¨re
- **Usage :** DÃ©finir le type d'agent de l'extincteur

### 3. **extincteurs â†” fire_extinguisher_certification_registry**
- `extincteurs.cert_ext` â†” `fire_extinguisher_certification_registry.certification`
- **Type :** Correspondance de valeurs (pas de clÃ© Ã©trangÃ¨re)
- **Usage :** Recherche automatique des informations de certification

---

## âš™ï¸ Logique mÃ©tier

### ğŸ” **Recherche de certification**
```javascript
// Quand l'utilisateur saisit un numÃ©ro de certification
searchCertification() {
  // 1. Recherche dans fire_extinguisher_certification_registry
  // 2. Si trouvÃ©, remplit automatiquement :
  //    - marque_ext â† marque
  //    - modele_ext â† modele  
  //    - agent_ext â† agent (recherche dans AgentExtincteur)
  //    - capa_ext â† capacit
}
```

### ğŸ“Š **Mise Ã  jour des capacitÃ©s selon l'agent**
```javascript
// Quand l'utilisateur change l'agent
updateCapaOptions() {
  // Selon l'agent sÃ©lectionnÃ©, charge les capacitÃ©s appropriÃ©es :
  // - Poudre : 1kg, 2kg, 3kg, 4kg, 6kg, 9kg, 25kg, 50kg, 100kg, 150kg
  // - CO2 : 2kg, 5kg, 10kg, 20kg
  // - Eau : 2Lt, 6Lt, 9Lt, 45Lt, 50Lt, 100Lt, 150Lt
}
```

### ğŸš« **DÃ©sactivation MAA/EIE**
```javascript
// Pour les extincteurs CO2, dÃ©sactive les champs MAA et EIE
updateMaaEieDisabled() {
  // Si agent contient 'co2' ou 'dioxyde' â†’ dÃ©sactive maa_ext et eie_ext
}
```

---

## ğŸ“ Validation des donnÃ©es

### âœ… **Champs obligatoires**
- `num_ext` : NumÃ©ro de l'extincteur
- `loc_ext` : Localisation

### ğŸ”„ **Conversion des dates**
- RCM, MAA, EIE : Format AAAA â†’ AAAA-01-01
- Si format invalide â†’ null

### ğŸ¯ **Types de donnÃ©es**
- `pcf_ext` : boolean (checkbox)
- `papp_ext` : boolean (checkbox)
- `agent_ext` : integer (rÃ©fÃ©rence AgentExtincteur)
- `id_site` : integer (rÃ©fÃ©rence sites)

---

**Ce document sert de rÃ©fÃ©rence pour comprendre les liens entre l'interface utilisateur et la structure de la base de donnÃ©es.** 