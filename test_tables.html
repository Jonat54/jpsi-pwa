<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Tables Supabase JPSI</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <style>
        body {
            font-family: monospace;
            margin: 20px;
            background: #1a1a1a;
            color: #00ff00;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #00ff00;
            padding-bottom: 20px;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #333;
        }
        .success {
            background: #003300;
            color: #00ff00;
        }
        .error {
            background: #330000;
            color: #ff0000;
        }
        .info {
            background: #000033;
            color: #0088ff;
        }
        .table-list {
            margin-top: 20px;
        }
        .table-item {
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #333;
            border-radius: 3px;
        }
        .exists {
            background: #003300;
            border-color: #00ff00;
        }
        .not-exists {
            background: #330000;
            border-color: #ff0000;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç TEST DES TABLES SUPABASE JPSI</h1>
            <p>V√©rification de l'existence des tables dans la base de donn√©es</p>
        </div>

        <div id="results"></div>
    </div>

    <script>
        // Configuration Supabase
        const SUPABASE_URL = 'https://anyzqzhjvankvbbajahj.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFueXpxemhqdmFua3ZiYmFqYWhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA3NTIzMjgsImV4cCI6MjA2NjMyODMyOH0.74pICcGtU_Ks0COTtPsSOQ8qtLfOzRHTNa1A41BAiMU';

        // Initialiser Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Tables √† tester (bas√©es sur DB.MD et les erreurs observ√©es)
        const tablesToTest = [
            'clients',
            'sites', 
            'alarmes',
            'peripheriques',
            'eclairages',
            'desenfumages',
            'extincteurs',
            'agentextincteur', // Cette table semble ne pas exister
            'fire_extinguisher_certification_registry',
            'verifications', // Cette table semble ne pas exister
            'eclairage_catalogue',
            'prospects',
            'audits',
            'audit_equipements'
        ];

        function addResult(message, type = 'info') {
            const resultsEl = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.textContent = message;
            resultsEl.appendChild(resultDiv);
        }

        function addTableResult(tableName, exists, error = null) {
            const resultsEl = document.getElementById('results');
            const tableDiv = document.createElement('div');
            tableDiv.className = `table-item ${exists ? 'exists' : 'not-exists'}`;
            
            if (exists) {
                tableDiv.innerHTML = `‚úÖ <strong>${tableName}</strong> - Table existe`;
            } else {
                tableDiv.innerHTML = `‚ùå <strong>${tableName}</strong> - Table n'existe pas${error ? ` (${error})` : ''}`;
            }
            
            resultsEl.appendChild(tableDiv);
        }

        async function testTables() {
            addResult('üöÄ D√©but du test des tables...', 'info');
            
            const existingTables = [];
            const nonExistingTables = [];

            for (const tableName of tablesToTest) {
                try {
                    addResult(`üîç Test de la table: ${tableName}...`, 'info');
                    
                    const { data, error } = await supabase
                        .from(tableName)
                        .select('*')
                        .limit(1);
                    
                    if (error) {
                        if (error.code === 'PGRST116') {
                            // Table n'existe pas
                            addTableResult(tableName, false, 'Table non trouv√©e');
                            nonExistingTables.push(tableName);
                        } else {
                            // Autre erreur
                            addTableResult(tableName, false, error.message);
                            nonExistingTables.push(tableName);
                        }
                    } else {
                        // Table existe
                        addTableResult(tableName, true);
                        existingTables.push(tableName);
                    }
                    
                    // Petite pause pour √©viter de surcharger l'API
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                } catch (err) {
                    addTableResult(tableName, false, err.message);
                    nonExistingTables.push(tableName);
                }
            }

            // R√©sum√© final
            addResult('', 'info');
            addResult('üìä R√âSUM√â FINAL:', 'info');
            addResult(`‚úÖ Tables existantes (${existingTables.length}): ${existingTables.join(', ')}`, 'success');
            addResult(`‚ùå Tables manquantes (${nonExistingTables.length}): ${nonExistingTables.join(', ')}`, 'error');
            
            // Suggestions
            if (nonExistingTables.length > 0) {
                addResult('', 'info');
                addResult('üí° SUGGESTIONS:', 'info');
                addResult('- V√©rifiez les noms des tables dans votre base de donn√©es', 'info');
                addResult('- Certaines tables peuvent avoir des noms diff√©rents', 'info');
                addResult('- V√©rifiez les permissions d\'acc√®s aux tables', 'info');
            }
        }

        // D√©marrer le test au chargement
        document.addEventListener('DOMContentLoaded', testTables);
    </script>
</body>
</html> 